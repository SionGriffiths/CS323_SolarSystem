\documentclass[titlepage]{article}

\addtolength{\oddsidemargin}{-.875in}
\addtolength{\evensidemargin}{-.875in}
\addtolength{\textwidth}{1.75in}

\addtolength{\topmargin}{-.875in}
\addtolength{\textheight}{1.75in}


\usepackage[font=footnotesize]{caption}
\usepackage{verbatim}
\usepackage[section]{placeins}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{tabularx} 



% --- XML Highlighting ---
\usepackage{listings}
\usepackage{color}
\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}
\definecolor{commentBlue}{rgb}{0.13, 0.53, 0.89}
\definecolor{stringGreen}{rgb}{0.43, 0.72, 0.26}
\definecolor{keywordOrange}{rgb}{0.97, 0.51, 0.15}

\lstdefinelanguage{JavaScript}{
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
  keywordstyle=\color{blue}\bfseries,
  ndkeywords={class, export, boolean, throw, implements, import, this},
  ndkeywordstyle=\color{keywordOrange}\bfseries,
  identifierstyle=\color{black},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{commentBlue}\ttfamily,
  stringstyle=\color{stringGreen}\ttfamily,
  morestring=[b]',
  morestring=[b]"
}

\lstset{
   language=JavaScript,
   backgroundcolor=\color{lightgray},
   extendedchars=true,
   basicstyle=\footnotesize\ttfamily,
   showstringspaces=false,
   showspaces=false,
   numbers=left,
   numberstyle=\footnotesize,
   numbersep=9pt,
   tabsize=2,
   breaklines=true,
   showtabs=false,
   captionpos=b
}
% --- ---- ---



% Title Page
\title{CS323 Assignment Report}
\author{Sion Griffiths - sig2}


% This just adds lines between paragraphs
\usepackage[parfill]{parskip}

%This allows diagrams to be added
\usepackage{graphicx}


\begin{document}
\maketitle
\tableofcontents




\newpage
\section{Introduction}

This report will detail the steps undertaken in constructing a visualisation of the Sun, Earth and Moon using WebGL and specifically the Three.js library.

To access the visualisation use the following link -  \url{http://users.aber.ac.uk/sig2/cs323/CS323\_SolarSystem/}


\begin{figure}[h!]
                \centering
                \includegraphics[width=0.8\columnwidth]{media/overview1}
                \caption{A screen capture showing an overview of the developed system}
                \label{fig:basic_model}
            \end{figure}


\section{Structure \& Implementation}
The code developed for this assignment can be split into 2 distinct packages, Model and Utils. The javascript files contained within the model package are essentially the descriptions of the entities within the system, the Earth, Sun and Moon. These files contain data regarding the state of the entities (geometry etc) along with functions which control their behaviour, for example the 'update' functions which control the changes to the entities(position etc) each iteration of the main logic loop.


The utils package contains utility code, split across various files depending on the nature of the code. The package contains files with utility code for the following: matrix functions, simple geometry functions and functions relating to the computation of orbits.


Separate from these two packages is the main.js file. This file serves as the entry point and initialisation of the system along with controlling the updating of the various parts of the system, entities, camera, GUI variables etc. 


The approach taken was an iterative one, starting with implementing the basic requirements using the native Three.js functionality, this allowed a basic understanding of the task at hand and provided a means to further familiarise myself with the Three.js framework. Once basic functionalities were implemented, prototyping of the extended requirements could begin, again in an iterative manner, since not everything worked as expected with Three.js to begin with.


\section{Orbits}

\subsection{Basics}
\subsubsection{Circular orbits}
During the initial prototyping stage of development, the orbits of the Earth and Moon were implemented as simple circles. This was achieved using simple trigonometry to update the relative positions on the x and z axes. The function to achieve this is shown in the code snippet below,:

\begin{lstlisting}
var earthDistanceFromSun = 24;
var earthRotationSpeed = 0.2;

var eathRot = function(earthMesh, sunMesh){
    
    var x = earthDistanceFromSun * -Math.cos(earthRotationAngle * (Math.PI / 180));
    var z = earthDistanceFromSun * -Math.sin(earthRotationAngle * (Math.PI / 180));
    earthRotationAngle-= earthOrbitRotationSpeed;
    
    earthMesh.position.x = sunMesh.position.x + x;
    earthMesh.position.z = sunMesh.position.z + z;
}

\end{lstlisting}

As the value for \texttt{earthRotationAngle} decreases with each iteration of the function, the positions calculated will 'swing' around an origin point. The calculated positions are added onto the sun's central position and applied to the Earth's position, such that the Earth will appear to circle around the sun.

\subsubsection{The earth orbits the centre of the sun \& The moon orbits the centre of the earth}
Using the technique described above, it's clear to see that this can be applied to any mesh to ensure that it's rotation is around the centre of another. Even if the other mesh has a dynamic position (as, in the case of the Moon orbiting the Earth as the Earth is moving around the Sun.), as the positions applied are relative as opposed to being absolute. The relative positions can be added to any other position to create the desired circular orbit.
 

\subsection{Extended}
\subsubsection{Elliptical orbits \& Non-uniform orbital velocities }
\subsubsection{Constant tilt of the Moon’s orbit}

\section{Textures and lighting}

\subsection{Basics}
\subsubsection{The sun, earth and moon shown as texture mapped spheres}

The spherical entities in the system (Sun, Earth and Moon) are meshes consisting of texture mapped sphere geometries. The geometries are defined as Three.js native SphereGeometry.

Texture mapping of the meshes was achieved using Three.js native loadTexture functionality, an example of the Earth mesh being defined is below:
\begin{lstlisting}
this.geometry = new THREE.SphereGeometry(4, 32, 32);
this.material = new THREE.MeshPhongMaterial();
this.material.map = THREE.ImageUtils.loadTexture('assets/images/earthmap1k.jpg');
\end{lstlisting}

\begin{figure}[h!]
                \centering
                \includegraphics[width=0.8\columnwidth]{media/textures}
                \caption{A screen capture showing texture detail}
                \label{fig:basic_model}
\end{figure}


\subsubsection{The sun shown as a self-illuminated sphere}
In order for the Sun to appear as self illuminated, the material for its mesh has been defined as emissive. The sun texture image itself is used as an emission map and a colour parameter is given. 
\begin{lstlisting}
this.material =  new THREE.MeshPhongMaterial({
    emissive: 0xF2E9A6, //emission colour
    emissiveMap: new THREE.TextureLoader().load("assets/images/sunmap.jpg")
});
\end{lstlisting}
\begin{figure}[h!]
                \centering
                \includegraphics[width=0.8\columnwidth]{media/sunShades}
                \caption{Emissive texture with different colours}
                \label{fig:basic_model}
\end{figure}

\subsubsection{Earth and moon lit by a single point light source located at the centre of the Sun}
This is the only requirement which could be considered unfulfilled. Indeed there is no point light in the centre of the sun. However, the Earth and Moon are lit from a light source at the centre of the Sun, in order for shadows to be implemented it was necessary to use a source other than point light since it does not support such functionality. This is a limitation imposed by Three.js for efficiency sake. Please see section below for details of the shadows.
\subsection{Extended}
\subsubsection{Lighting of the earth and moon in Phong shading}
\subsubsection{Non-illuminated parts of the earth and moon to be shown in shadow}
\medskip

\section{Axes and tilts}

\subsection{Basics}
\subsubsection{The sun, earth and moon each spinning on their own axes}
\subsection{Extended}
\subsubsection{Constant tilt of the earth’s axis}

\section{User Interface}
\subsection{Suitable user control interface for viewing, scaling, timing}
\section{Self Assessment}

 \begin{tabularx}{0.8\columnwidth}{| X | X | X |}
            \hline
            Task & Documented & Implemented \\
            \hline
            1 & x & ✓ \\
            \hline
            2 & ✓ & ✓ \\
            \hline
            3 & ✓ & ✓ \\
            \hline
            4 & ✓ & ✓ \\
            \hline
            5 & ✓ & ✓ \\
            \hline
            7 & ✓ & ✓ \\
            \hline
            7 & ✓ & ✓ \\
            \hline
        \end{tabularx} \\



 \begin{thebibliography}{1}
 	
 	\bibitem{replyBuy} David Uccelli, Multichannel Blog {\em http://www.multichannel-blog.co.uk/2012/02/13/80-of-portaltech-uk-hybris-partner-bought-for-1-6m/} Accessed September 2015
 	\bibitem{growthGraph} Reply LTD, Company profile {\em http://www.reply.eu/InvestorsDocuments/en/Company\_Profile\_eng.pdf} Accessed September 2015
 	\bibitem{stock} Google Finance, Reply S.p.A profile {\em https://www.google.co.uk/finance?q=BIT\%3AREY} Accessed September 2015
 	
 	
 	
 	
 		
 %	\bibitem{hoover} Dun \& Bradstreet, Hoover.com - Corporate Data Analyser and Aggregator {\em http://bit.ly/1Dj9e1m }

	


 \end{thebibliography}


\end{document}